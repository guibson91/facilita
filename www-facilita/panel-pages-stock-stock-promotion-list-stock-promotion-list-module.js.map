{"version":3,"sources":["webpack:///./src/app/panel/pages/stock/stock-promotion-list/stock-promotion-list.module.ts","webpack:///./src/app/panel/pages/stock/stock-promotion-list/stock-promotion-list.page.html","webpack:///./src/app/panel/pages/stock/stock-promotion-list/stock-promotion-list.page.scss","webpack:///./src/app/panel/pages/stock/stock-promotion-list/stock-promotion-list.page.ts","webpack:///./src/app/services/promotion.service.ts"],"names":[],"mappings":"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","file":"panel-pages-stock-stock-promotion-list-stock-promotion-list-module.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { StockPromotionListPage } from './stock-promotion-list.page';\r\nimport { PanelComponentsModule } from '../../../components/panel-components.module';\r\nimport { GlobalComponentsModule } from '../../../../components/global-components.module';\r\nimport { NgPipesModule } from 'ngx-pipes';\r\nimport { PipesModule } from '../../../../pipes/pipes.module';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: StockPromotionListPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    ReactiveFormsModule,\r\n    PanelComponentsModule,\r\n    GlobalComponentsModule,\r\n    NgPipesModule,\r\n    PipesModule,\r\n    RouterModule.forChild(routes)\r\n  ],\r\n  declarations: [StockPromotionListPage]\r\n})\r\nexport class StockPromotionListPageModule { }\r\n","module.exports = \"<ion-header no-border>\\r\\n\\t<nano-navbar title=\\\"Estoque de promoções\\\" icon=\\\"menus-icon-ecommerce-45\\\">\\r\\n\\t</nano-navbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content padding>\\r\\n\\t<ion-card class=\\\"content-card\\\">\\r\\n\\r\\n\\t\\t<div class=\\\"myfilter\\\">\\r\\n\\t\\t\\t<ion-searchbar clear [(ngModel)]=\\\"searchString\\\" placeholder=\\\"Pesquisar\\\" (ionChange)=\\\"detect()\\\"></ion-searchbar>\\r\\n\\t\\t</div>\\r\\n\\r\\n\\t\\t<nano-loading [loading]=\\\"loading\\\">\\r\\n\\r\\n\\t\\t\\t<ion-list>\\r\\n\\t\\t\\t\\t<div *ngFor=\\\"let promotion of promotionsStock | filterBy:['name', 'description']:searchString; let i = index\\\"\\r\\n\\t\\t\\t\\t class=\\\"promotions\\\">\\r\\n\\t\\t\\t\\t\\t<div class=\\\"list-item\\\">\\r\\n\\t\\t\\t\\t\\t\\t<nano-thumb class=\\\"promotion-item\\\" [ngClass]=\\\"{'inactive': !promotion.active}\\\" [src]=\\\"promotion.image\\\" [border]=\\\"true\\\"></nano-thumb>\\r\\n\\t\\t\\t\\t\\t\\t<div class=\\\"promotion-item\\\" style=\\\"flex-grow: 1\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"name\\\" [ngClass]=\\\"{'inactive': !promotion.active}\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t\\t{{promotion.name}}\\r\\n\\t\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t<div class=\\\"description\\\">{{promotion.description}}</div>\\r\\n\\t\\t\\t\\t\\t\\t\\t<ion-button fill=\\\"clear\\\" color=\\\"success\\\" *ngIf=\\\"!promotion.active\\\" (click)=\\\"addPromotion(promotion)\\\">Adicionar</ion-button>\\r\\n\\t\\t\\t\\t\\t\\t\\t<ion-button fill=\\\"clear\\\" color=\\\"danger\\\" *ngIf=\\\"promotion.active\\\" (click)=\\\"removePromotion(promotion)\\\">Remover</ion-button>\\r\\n\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t\\t<div class=\\\"promotion-item\\\">\\r\\n\\t\\t\\t\\t\\t\\t\\t<ion-button fill=\\\"clear\\\" class=\\\"price\\\">R$ {{promotion.priceBase | number: '1.2-2'}}</ion-button>\\r\\n\\t\\t\\t\\t\\t\\t</div>\\r\\n\\t\\t\\t\\t\\t</div>\\r\\n        </div>\\r\\n        \\r\\n\\t\\t\\t\\t<ion-item text-center padding *ngIf=\\\"!existsPromotions\\\">\\r\\n\\t\\t\\t\\t\\t<p ion-text>Você ainda não possui nenhuma promoção</p>\\r\\n\\t\\t\\t\\t  </ion-item>\\r\\n\\t\\t\\t</ion-list>\\r\\n\\t\\t</nano-loading>\\r\\n\\r\\n\\t</ion-card>\\r\\n\\r\\n</ion-content>\"","module.exports = \"ion-content {\\n  background-color: #f8f8f8 !important; }\\n\\nion-grid ion-icon {\\n  margin-top: 14px;\\n  font-size: 2.2em; }\\n\\nion-card {\\n  margin-bottom: 60px !important; }\\n\\n.promotions {\\n  font-family: myFontRegular !important;\\n  margin: auto; }\\n\\n.promotions .list-item {\\n    display: flex;\\n    margin: 0.6em 0 0.6em 1.6em;\\n    background-color: white !important;\\n    margin-bottom: solid 1px #ddd !important;\\n    padding: 8px 0px 8px 0px !important; }\\n\\n@media (max-width: 400px) {\\n      .promotions .list-item {\\n        flex-direction: column;\\n        align-items: center; } }\\n\\n.promotions .list-item .promotion-item {\\n      -ms-grid-row-align: center;\\n          align-self: center;\\n      margin-right: 1.2em; }\\n\\n@media (max-width: 400px) {\\n        .promotions .list-item .promotion-item {\\n          text-align: center; } }\\n\\n.promotions .list-item .promotion-item .name {\\n        font-size: 1.4em;\\n        color: black; }\\n\\n.promotions .list-item .promotion-item .name.inactive {\\n          color: #999; }\\n\\n.promotions .list-item .promotion-item .description {\\n        font-size: 1em;\\n        color: #999; }\\n\\n.promotions .list-item .promotion-item .price {\\n        white-space: nowrap;\\n        font-size: 1.4em;\\n        color: #4c4; }\\n\\n.promotions .list-item .promotion-item button {\\n        font-weight: bold !important; }\\n\\n.button-md {\\n  margin: 0px !important;\\n  padding: 0px !important;\\n  padding-left: 5px !important;\\n  padding-right: 5px !important;\\n  margin-left: -5px !important; }\\n\\nion-searchbar {\\n  border-bottom: none !important; }\\n\\n.myfilter {\\n  display: flex;\\n  border-bottom: solid 2px #ddd !important; }\\n\\n.myfilter ion-searchbar {\\n    flex-grow: 1; }\\n\\n.myfilter button {\\n    -ms-grid-row-align: center;\\n        align-self: center;\\n    margin-right: 8px !important; }\\n\\nnano-thumb.inactive {\\n  opacity: 0.5 !important; }\\n\"","import { Component, OnInit, OnDestroy, ChangeDetectorRef } from '@angular/core';\r\nimport { Company } from '../../../../../models/company';\r\nimport { Filial } from '../../../../../models/filial';\r\nimport { PromotionStock, PromotionService } from '../../../../services/promotion.service';\r\nimport { Subscription, of, combineLatest } from 'rxjs';\r\nimport { NavController, PopoverController, AlertController, MenuController, LoadingController } from '@ionic/angular';\r\nimport { SharedService } from '../../../../services/shared.service';\r\nimport { ActivatedRoute, ParamMap } from '@angular/router';\r\nimport { SystemService } from '../../../../services/system.service';\r\nimport { switchMap, first, map } from 'rxjs/operators';\r\n\r\n@Component({\r\n  selector: 'app-stock-promotion-list',\r\n  templateUrl: './stock-promotion-list.page.html',\r\n  styleUrls: ['./stock-promotion-list.page.scss'],\r\n})\r\nexport class StockPromotionListPage implements OnInit, OnDestroy {\r\n\r\n  /**\r\n   * Capta o que foi digitado pelo usuário no campo de pesquisa\r\n   */\r\n  searchString: string = \"\";\r\n\r\n  /**\r\n   * Empresa no qual está sendo listado as promoções\r\n   */\r\n  company: Company;\r\n\r\n  /**\r\n   * Filial atual que será listado as promoções\r\n   */\r\n  filial: Filial;\r\n\r\n  /**\r\n   * Lista de todas as promoções da empresa,\r\n   * mas com o atributo active(se está presente na filial)\r\n   */\r\n\r\n  promotionsStock: PromotionStock[];\r\n\r\n  /**\r\n   * Subscription do observable que consulta promoções\r\n   */\r\n  promotionsStockSubscription: Subscription\r\n\r\n  /**\r\n   * Verifica se existe promoções\r\n   */\r\n  existsPromotions: boolean = false\r\n\r\n  /**\r\n   * Exibir loading quando a lista estiver sendo carregada\r\n   */\r\n  loading: boolean = true;\r\n\r\n  /**\r\n   * Subscription do observable que carrega as categorias\r\n   */\r\n  initSubscription: Subscription\r\n\r\n  constructor(private navCtrl: NavController,\r\n    private popoverCtrl: PopoverController,\r\n    private alertCtrl: AlertController,\r\n    private menuCtrl: MenuController,\r\n    private ref: ChangeDetectorRef,\r\n    private promotionService: PromotionService,\r\n    private shared: SharedService,\r\n    private route: ActivatedRoute,\r\n    private loadingCtrl: LoadingController,\r\n    private system: SystemService) { }\r\n\r\n  /**\r\n   * Inicializando estruturas após entrar na página\r\n   * e passar pela verificação do ionViewCanEnter()\r\n   */\r\n  ngOnInit(): void {\r\n    //Mostrar loading\r\n    this.loading = true;\r\n    this.menuCtrl.enable(true);\r\n\r\n    let company$ = this.route.paramMap\r\n      .pipe(switchMap((params: ParamMap) => {\r\n        if (params.get('company_id'))\r\n          return Company.object(params.get('company_id'))\r\n        else\r\n          return of(null)\r\n      }))\r\n      .pipe(first())\r\n\r\n    let filial$ = this.route.paramMap\r\n      .pipe(switchMap((params: ParamMap) => {\r\n        if (params.get('filial_id'))\r\n          return Filial.object(params.get('filial_id'))\r\n        else\r\n          return of(null)\r\n      }))\r\n      .pipe(first())\r\n\r\n    this.initSubscription = combineLatest([\r\n      company$,\r\n      filial$\r\n    ])\r\n      .subscribe((arr: [Company, Filial]) => {\r\n        this.company = arr[0];\r\n        this.filial = arr[1];\r\n\r\n        this.refresh()\r\n      }, err => {\r\n        this.loading = false;\r\n        this.system.showErrorAlert(err)\r\n        this.ref.detectChanges()\r\n      })\r\n  }\r\n\r\n  refresh() {\r\n    this.loading = true\r\n    this.ref.detectChanges();\r\n    if (this.promotionsStockSubscription) this.promotionsStockSubscription.unsubscribe()\r\n\r\n    //Obtém lista de promoções de estoque de uma filial ordenados\r\n    this.promotionsStockSubscription = this.promotionService.getPromotionsStockFilial(this.filial)\r\n      .subscribe((promotion_stock: PromotionStock[]) => {\r\n        this.promotionsStock = promotion_stock;\r\n\r\n        if (!this.promotionsStock || this.promotionsStock.length <= 0) this.existsPromotions = false;\r\n        else this.existsPromotions = true;\r\n\r\n        this.loading = false;\r\n        this.ref.detectChanges()\r\n      }, err => {\r\n        this.loading = false;\r\n        this.system.showErrorAlert(err)\r\n        this.ref.detectChanges()\r\n      })\r\n  }\r\n\r\n  detect() {\r\n    this.ref.detectChanges()\r\n  }\r\n\r\n  /**\r\n   * Adiciona a promoção no estoque.\r\n   * @param promotion Promoção a ser adicionada\r\n   */\r\n  addPromotion(promotion: PromotionStock): void {\r\n    Filial.promotion_stock.add(this.filial.id, promotion.id, { active: true, quantity: promotion.quantity || 0 })\r\n      .subscribe(() => {\r\n        this.ref.detectChanges()\r\n      }, err => {\r\n        this.system.showErrorAlert(err);\r\n      });\r\n  }\r\n\r\n  /**\r\n   * Remove a promoção do estoque.\r\n   * @param promotion Promoção a ser removida\r\n   */\r\n  removePromotion(promotion: PromotionStock, index: number): void {\r\n    //Remove a relação da promoção com o estoque.\r\n    Filial.promotion_stock.add(this.filial.id, promotion.id, { active: false, quantity: promotion.quantity || 0 })\r\n      .subscribe(() => {\r\n        // this.refresh()\r\n        this.ref.detectChanges()\r\n      }, err => {\r\n        this.system.showErrorAlert(err);\r\n      });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    if (this.initSubscription) this.initSubscription.unsubscribe()\r\n    if (this.promotionsStockSubscription) this.promotionsStockSubscription.unsubscribe()\r\n  }\r\n}","import { Injectable } from '@angular/core';\r\nimport { Promotion } from '../../models/promotion';\r\nimport { Company } from '../../models/company';\r\nimport { Filial } from '../../models/filial';\r\nimport { Observable, combineLatest } from 'rxjs';\r\nimport { RelationshipField } from '../../modules/firestore/collection-relationship';\r\nimport { map } from 'rxjs/operators';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class PromotionService {\r\n\r\n  constructor() { }\r\n\r\n  /**\r\n   * Busca uma lista de promoções de uma filial.\r\n   * Adiciona nessa lista de promoções as informações do relacionamento.\r\n   * Gerando Promoções com:\r\n   * Atributos do produto. Active e quantity\r\n   * Se active true então existe o relacionamento com a filial. Se false não existe relacionamento da promoção com a filial.\r\n   * Demais atributos diretos do relacionamento Filial.promotions_stock\r\n   * @param id_filial Id da filial\r\n   */\r\n  public getPromotionsStockFilial(filial: Filial): Observable<PromotionStock[]> {\r\n    console.log(filial)\r\n    let promotions$: Observable<Promotion[]> = Company.promotions.list(filial.company.id)\r\n    let relations$: Observable<({ active?: boolean, quantity?: number } & RelationshipField)[]> = Filial.promotion_stock.listRelation(filial.id)\r\n\r\n    return combineLatest([\r\n      promotions$,\r\n      relations$\r\n    ])\r\n      .pipe(map((arr: [Promotion[], ({ active?: boolean, quantity?: number } & RelationshipField)[]]) => {\r\n        let promotions: PromotionStock[] = arr[0];\r\n        let relations: ({ active?: boolean, quantity?: number } & RelationshipField)[] = arr[1];\r\n\r\n        let id_promotion_to_relationship = {}\r\n        for (let obj of relations) {\r\n          id_promotion_to_relationship[obj.id] = obj\r\n        }\r\n\r\n        // Para todos as promoções verificar as informações do relacionamento\r\n        for (let promotion of promotions) {\r\n          // Se existir o relacionamento do produto com a filial\r\n          if (id_promotion_to_relationship[promotion.id]) {\r\n            promotion.active = (id_promotion_to_relationship[promotion.id].active === undefined ? true : id_promotion_to_relationship[promotion.id].active)\r\n            promotion.quantity = (id_promotion_to_relationship[promotion.id].quantity === undefined ? 0 : id_promotion_to_relationship[promotion.id].quantity)\r\n          } else {\r\n            promotion.active = false;\r\n          }\r\n          // Se não existir o relacionamento do produto com a filial\r\n        }\r\n        return promotions\r\n      }))\r\n  }\r\n}\r\n\r\nexport type PromotionStock = (\r\n  Promotion & {\r\n    active?: boolean,\r\n    quantity?: number\r\n  });"],"sourceRoot":""}